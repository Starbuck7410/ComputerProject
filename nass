#!/bin/sh
wd=$(dirname $1)
echo
if [[ $1 = "" ]]; then
    ./assemble
    exit 1
fi
if [[ $1 = "-h" ]]; then
    echo "Usage: ./nass <file.asm>"
    exit 0
fi
mkdir "$(echo $wd)"/build
mkdir "$(echo $wd)"/run 
./assemble "$1" "$(echo $wd)/build/imemin.txt" "$(echo $wd)/build/dmemin.txt" "$(echo $wd)/build/diskin.txt" "$(echo $wd)/build/irq2in.txt"
if [ $? -ne 0 ]; then
    exit 1
fi
echo
echo "Program $1 compiled successfully!"
echo "Running simulator..."
echo
./simulate "$(echo $wd)/build/imemin.txt" "$(echo $wd)/build/dmemin.txt" "$(echo $wd)/build/diskin.txt" "$(echo $wd)/build/irq2in.txt" "$(echo $wd)/run/dmemout.txt" "$(echo $wd)/run/regout.txt" "$(echo $wd)/run/trace.txt" "$(echo $wd)/run/hwregtrace.txt" "$(echo $wd)/run/cycles.txt" "$(echo $wd)/run/leds.txt" "$(echo $wd)/run/display7seg.txt" "$(echo $wd)/run/diskout.txt" "$(echo $wd)/run/monitor.txt" "$(echo $wd)/run/monitor.yuv"
if [ $? -eq 0 ]; then
    echo "Simulation finished successfully!"
    exit 0
else
    exit 1
fi
